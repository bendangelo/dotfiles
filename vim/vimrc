set t_Co=256

set nocompatible              " be iMproved, required
filetype off                  " required
syntax on
set suffixesadd+=.rb
"set mouse=a
" Auto indent
filetype indent on
filetype plugin indent on
set list
set list listchars=tab:»·,trail:·
set autowrite

" set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#rc()
let g:solarized_termcolors=256
set wildignore=*.o,*.obj,*.bak,*.exe,*.py[co],*.swp,*~,*.pyc,.svn,.git,*.meta

set pastetoggle=<F10>
set number
set cursorline
set noswapfile
set autoindent
set hlsearch
set ignorecase
set smartcase
set nobackup
set laststatus=2
set ttimeoutlen=50
" a combination of spaces and tabs are used to simulate tab stops at a width
" other than the (hard)tabstop
set softtabstop=2
set smarttab
set expandtab
set shiftwidth=2
set complete=.,b,u,]

augroup vimrcEx
  autocmd!

  " When editing a file, always jump to the last known cursor position.
  " Don't do it for commit messages, when the position is invalid, or when
  " inside an event handler (happens when dropping a file on gvim).
  autocmd BufReadPost *
    \ if &ft != 'gitcommit' && line("'\"") > 0 && line("'\"") <= line("$") |
    \   exe "normal g`\"" |
    \ endif

  " Set syntax highlighting for specific file types
  autocmd BufRead,BufNewFile *.md set filetype=markdown

  " Enable spellchecking for Markdown
  autocmd FileType markdown setlocal spell

  " Automatically wrap at 80 characters for Markdown
  autocmd BufRead,BufNewFile *.md setlocal textwidth=80
augroup END

" gvim
if has('gui_running')
    set go-=T
    set guifont=Liberation\ Mono\ 8
    set go-=r
    set go-=L
endif

call vundle#begin()
" let Vundle manage Vundle, required
Plugin 'gmarik/vundle'
Plugin 'kchmck/vim-coffee-script'
Plugin 'wellle/targets.vim'
Plugin 'ervandew/supertab'
Plugin 'michaeljsmith/vim-indent-object'
Plugin 'henrik/vim-qargs'
Plugin 'tpope/vim-sensible'
Plugin 'altercation/vim-colors-solarized'
Plugin 'plasticboy/vim-markdown'
Plugin 'tpope/vim-fugitive'
Plugin 'tpope/vim-rails.git'
Plugin 'scrooloose/nerdtree'
Plugin 'L9'
Plugin 'justinmk/vim-sneak'
Plugin 'ConradIrwin/vim-bracketed-paste'
Plugin 'tpope/vim-surround'
Plugin 'tpope/vim-repeat'
Plugin 'kana/vim-operator-user'
Plugin 'rgrinberg/vim-operator-gsearch'
Plugin 'kien/ctrlp.vim'
Plugin 'tomtom/tcomment_vim'
Plugin 'flazz/vim-colorschemes'
Plugin 'mileszs/ack.vim.git'
Plugin 'vim-scripts/a.vim'
Plugin 'christoomey/vim-tmux-navigator'
Plugin 'scrooloose/syntastic'
Plugin 'slim-template/vim-slim.git'
Plugin 'thoughtbot/vim-rspec'
Plugin 'benmills/vimux'
call vundle#end()

let g:ctrlp_custom_ignore = {
            \ 'dir': 'bower_components\|build\|dist\|docs\|export\|node_modules\|DS_Store\|git',
            \ 'file': '\.meta$'
            \ }
let g:ctrlp_working_path_mode = 2
let g:ctrlp_max_depth = 5

" RSpec.vim mappings
map <Leader>tc :call RunCurrentSpecFile()<CR>
map <Leader>tn :call RunNearestSpec()<CR>
map <Leader>tl :call RunLastSpec()<CR>
map <Leader>ta :call RunAllSpecs()<CR>

let g:rspec_command = 'call VimuxRunCommand("rspec {spec}\n")'

function! VimuxSlime()
  call VimuxSendText(@v)
 endfunction

 " If text is selected, save it in the v buffer and send that buffer it to tmux
 vmap <LocalLeader>vs "vy :call VimuxSlime()<CR>

 " Select current paragraph and send it to tmux
"  nmap <LocalLeader>vs vip<LocalLeader>vs<CR>

" Leader shortcuts
" current working directory
nnoremap <leader>F :CtrlPCurWD<CR>
" most recently used files
nnoremap <leader>r :CtrlPMRUFiles<CR>
nnoremap <leader>m :CtrlPMixed<CR>

nnoremap <leader>aa :A<CR>
nnoremap <leader>av :AV<CR>
nnoremap <leader>at :AT<CR>

nnoremap <leader><leader> <C-^>

map g/ <Plug>(operator-ack)

vmap <Leader>y "+y
nmap <Leader>p "+p
nmap <Leader>P "+P
nmap <Leader>y "+y
vmap <Leader>p "+p
vmap <Leader>P "+P

map <leader>s :so $MYVIMRC<CR>
map <leader>ev :vs $MYVIMRC<CR>
map <leader>eb :vs ~/.bashrc<CR>
map <leader>eg :vs ~/.gitconfig<CR>
map <leader>es :vs ~/.ssh/config<CR>
map <leader>ea :vs ~/.agignore<CR>
map <leader>eh :vs /etc/hosts<CR>
map <leader>et :vs ~/.tmux.conf<CR>
map <leader>ei :vs .gitignore<CR>

" fugitive shortcuts
map <leader>gb :Gblame<CR>

" format the entire file
nmap <leader>fe ggVG=
map <Leader>fa ggVG

" Change color
nnoremap <leader>cg :color gruvbox<CR>
nnoremap <leader>ch :color hybrid<CR>
nnoremap <leader>cr :color railscasts<CR>
nnoremap <leader>cd :color desertEx<CR>
nnoremap <leader>cw :color badwolf<CR>
nnoremap <leader>cm :color babymate256<CR>

" Shortcuts
map gb :NERDTreeToggle<CR>
nmap <silent> z/ :nohlsearch<CR>

" force save
cmap w!! w !sudo tee % >/dev/null

imap jk <Esc>

nnoremap <C-J> <C-W><C-J>
nnoremap <C-K> <C-W><C-K>
nnoremap <C-L> <C-W><C-L>
nnoremap <C-H> <C-W><C-H>
noremap <Tab> <c-w><c-w>
noremap <S-Tab> <c-w>w
nmap Y y$
nmap zh ^
nmap zl $
vmap zh ^
vmap zl $
map Q @@

" better command line editing
cnoremap <C-j> <t_kd>
cnoremap <C-k> <t_ku>
cnoremap <C-a> <Home>
cnoremap <C-e> <End>

" strip all trailing whitespace in the current file
nnoremap <leader>fw :%s/\s\+$//<cr>:let @/=''<CR>
" reselect the text that was just pasted
nnoremap gV `[v`]
nnoremap =p `[v`]=

if executable("ag")
    let g:ackprg = 'ag --nogroup --nocolor --column'

    " Use Ag over Grep
    set grepprg=ag\ --nogroup\ --nocolor

    " Use ag in CtrlP for listing files. Lightning fast and respects .gitignore
    let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'

    " ag is fast enough that CtrlP doesn't need to cache
    let g:ctrlp_use_caching = 1
endif

colorscheme default
set background=dark

" automatic formatting
autocmd BufWritePre *.slim :%s/\s\+$//e
autocmd BufWritePre *.rb :%s/\s\+$//e
autocmd BufWritePre *.hx :%s/\s\+$//e

au BufReadPost *.hxp set syntax=haxe
au BufReadPost *.hx set syntax=haxe
au BufReadPost *.md set syntax=markdown
au BufReadPost *.less set syntax=less
au BufReadPost *.coffee set syntax=coffee
au BufReadPost *.slim set syntax=slim
" reload file on vim focus and buf enter
au CursorHold * checktime

" Treat <li> and <p> tags like the block tags they are
let g:html_indent_tags = 'li\|p'

" Open new split panes to right and bottom, which feels more natural
set splitbelow
set splitright

let g:syntastic_check_on_open=1
let g:syntastic_html_tidy_ignore_errors=[" proprietary attribute \"ng-"]

" smartgf settings
" cursor line breaks jk support
let g:smartgf_extensions = ['.cs', '.coffee', '.js']

" Search for selected text, forwards or backwards.
vnoremap <silent> * :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy/<C-R><C-R>=substitute(
  \escape(@", '/\.*$^~['), '\_s\+', '\\_s\\+', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR>
vnoremap <silent> # :<C-U>
  \let old_reg=getreg('"')<Bar>let old_regtype=getregtype('"')<CR>
  \gvy?<C-R><C-R>=substitute(
  \escape(@", '?\.*$^~['), '\_s\+', '\\_s\\+', 'g')<CR><CR>
  \gV:call setreg('"', old_reg, old_regtype)<CR>
